name: Release
on:
    workflow_dispatch:
    push:
        branches:
            - release*

run-name: "This workflow is triggered by @ ${{ github.actor }} on the event: ${{ github.event_name }}"

jobs:
    Gradle-Build:
        runs-on: ubuntu-latest
        steps:
            - name: Build
              run: echo "Gradle build on $(date)"
    
    Docker-Build:
        runs-on: ubuntu-latest
        if: ${{ github.event_name == 'workflow_dispatch' }}
        needs: Gradle-Build
        steps:
            - name: Docker build
              run: echo "Docker build on $(date)"

    Helm-Package:
        runs-on: ubuntu-latest
        if: ${{ github.event_name == 'workflow_dispatch' }}
        needs: Docker-Build
        steps:
            - name: Helm Package
              run: echo "Helm Package on $(date)"
    
    Deploy-to-cert:
        runs-on: ubuntu-latest
        needs: Helm-Package
        if: ${{ github.event_name == 'workflow_dispatch' }}
        environment: cert
        steps:
            - name: Deploy to cert
              run: echo "Deployed on cert on $(date)"

    Deploy-to-pre-prod:
        runs-on: ubuntu-latest
        needs: Deploy-to-cert
        if: ${{ github.event_name == 'workflow_dispatch' }}
        environment: pre-prod
        steps:
            - name: Deploy to pre-prod
              run: echo "Deployed on pre-prod on $(date)"

    Deploy-to-prod:
        runs-on: ubuntu-latest
        needs: Deploy-to-pre-prod
        if: ${{ github.event_name == 'workflow_dispatch' }}
        environment: prod
        steps:
            - name: Deploy to prod
              run: echo "Deployed on prod on $(date)"